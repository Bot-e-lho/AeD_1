#include <stdio.h>
#include <stdlib.h>

typedef long key;

typedef struct Node {
    key num;
    int height;
    struct Node* left;
    struct Node* right;
} Node;

int max(int a, int b) {
    return (a > b) ? a : b;
}

int height(struct Node* node) {
    if (node == NULL)
        return 0;
    return node->height;
}

Node* create(key a) {
    Node* node = (Node*)malloc(sizeof(Node));
    node->num = a;
    node->height = 1;
    node->left = NULL;
    node->right = NULL;
    return node;
}

Node* rot_left(Node* y) {
    Node* x = y->right;
    y->right = x->left;
    x->left = y;
    y->height = max(height(y->left), height(y->right)) + 1;
    x->height = max(height(x->left), height(x->right)) + 1;
    return x;
}

Node* rot_right(Node* x) {
    Node* y = x->left;
    x->left = y->right;
    y->right = x;
    x->height = max(height(x->left), height(x->right)) + 1;
    y->height = max(height(y->left), height(y->right)) + 1;
    return y;
}

int balance(Node* node) {
    if (node == NULL)
        return 0;
    return height(node->left) - height(node->right);
}

Node* insere(Node* node, key a) {
    if (node == NULL)
        return create(a);

    if (a < node->num)
        node->left = insere(node->left, a);
    else if (a > node->num)
        node->right = insere(node->right, a);
    else
        return node;

    node->height = 1 + max(height(node->left), height(node->right));

    int balance = balance(node);

    if (balance > 1 && a < node->left->num)
        return rot_right(node);

    if (balance < -1 && a > node->right->num)
        return rot_left(node);

    if (balance > 1 && a > node->left->num) {
        node->left = rot_left(node->left);
        return rot_right(node);
    }

    if (balance < -1 && a < node->right->num) {
        node->right = rot_right(node->right);
        return rot_left(node);
    }

    return node;
}

void freeTree(Node* no) {
    if (no != NULL) {
        freeTree(no->left);
        freeTree(no->right);
        free(no);
    }
}

void print(Node* no) {
    if (no != NULL) {
        print(no->left);
        printf("%ld ", no->num);
        print(no->right);
    }
}

int main(int argc, char const* argv[]) {
    Node* no = NULL;

    no = insere(no, 30);
    no = insere(no, 20);
    no = insere(no, 40);
    no = insere(no, 10);
    no = insere(no, 50);
    no = insere(no, 25);
    no = insere(no, 35);

    printf("\nArvore:\n");
    print(no);
    printf("\n");

    freeTree(no);
    return 0;
}
